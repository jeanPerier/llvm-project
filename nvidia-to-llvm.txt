How to cherry-pick commits from f18-stage to llvm-project

Do once:
  git clone https://github.com/llvm/llvm-project.git $DIRECTORY
  cd $DIRECTORY
  git remote add f18-stage ssh://git@gitlab-master.nvidia.com:12051/fortran/f18-stage.git

To look for changes to merge from NVIDIA to LLVM:
  git fetch f18-stage # or --all
  git log f18-stage/master >log.tmp
  $EDITOR log.tmp nvidia-to-llvm.txt
# Look for new commits, add to log below
# Ignore merge commits and changes to cherrypicking.txt.

For each change to merge:
  git checkout main
  git pull
  git checkout -b $BRANCH
  git cherry-pick $COMMIT
# build and test
  if arc works
  then arc diff
  else git show HEAD >mydiff
       # load into phabricator
       git commit --amend # add "Differential Revision: <url>"
  fi
# set Subscribers: flang-commits and Tags: #flang
# get it approved in phabricator
  if arc works
  then arc land --hold $BRANCH
       git commit --amend # clean up the commit message
       git show -s # get the new HEAD commit number as $AMENDEDHEAD
       git push -- origin $AMENDEDHEAD:main
  else git push -- origin $BRANCH:main
  fi
  git checkout main
  git pull
  git checkout $BRANCH
  git rebase -i main # ensure that changes are now "no-op"
  git checkout main
  git branch -D $BRANCH

To do (oldest last):

In review:
34b9684c0d5bad7af7019f32e59f52d6d08de484 fix list-directed plural null input at EOR
70fe2f3eccc75d18a0fa2c1645e737ec632b64e3 fix typos in two runtime API names
516557d3f33d8f1d228b7df443502d31b1734534 fix crash in runtime-type-info

Done (oldest last, omitting no-ops):
931b37621fd3572bcbcee1bc9f007d975a666d0e Assign()
3dde9a7b515862757d7de37f33e6627056df10b9 fix Fw.d output looping
02722d7b3340e7117286d14567fe06fed9d29633 dfloat
acb00fbdf56b7e4dad0bac68f98aba49daa33bc6 represent dummy SubprogramDetails
7eda149e615c506ea21c1e95068bc9c71c5371d6 fix IsSimplyContiguous for pointer component ref
6578893a0453384346f149479f8574dfff977ace fix I/O bugs around EOF and delimited chars
1bba6436c16dda0815f8a6722318ed081ac3d39a reset list-directed input state for each NAMELIST item
bad7ee9a4a29c18e3def86c58745dabee325db90 run-time derived type init & final
9e3ffa0144ac85c7860c3bc493575913493a9a7d data pointers in runtime
bfeecace2e0024fb8231513ab0f3af1d2b2d46c9 non-advancing I/O, $
cfd9852a2b5f6a7477d28e1eff058f40cf70e4de user-defined derived type I/O
dd4833a2c938d439bb3ae796fc9a1ba7dbd7929e fix generic/specific confusion
b9d36f6b3ca0ee710cd649ff6192abcf53ad213f fold more reductions (all, any, iall, iany, iparity, product, sum)
ca42b73e36435fe5b456dbec5d4c34d37c40fb0d default derived type I/O
8196eafea5214f8afc85ce870368146881072ead iall & iany in runtime
15d1be83521743b4ba1c8c1f21848ae11c61c5bb Kahan summation
ee460fa7b905abf4104522b2e30a13079d09dda2 fold maxval & minval
377416edea8c42a2794ac460c7f8c44e96e6fac0 array c'tor error recovery
038aea099daf48ee9800987d1b08dca68555159f fix crash on call to insufficiently defined proc
fffe4583f06f6595e2e2ab15b60b42c79321e3d0 fix crash on bad expression
5bdb13adac7acc95756c06c024016b6a6bab897f patch CharacterTest.cpp +
dfded349a0b1b9e9da1e2777a90ffd1dab89052b correct subscripts for args in char intrinsics
4e5c1ae79832ca05c79f36d36d4bc69463688d15 tristate-ify CheckConformance
74ce3b4778cc881e2ddc39f5fb2a1902d902acaa INTERFACE symbol resolution
dfc95b70419de4e1c130de0485ab39113e62c770 characterize EntityDetails dummy arguments
ca0c70ceeb9bb108ce19807efe7cb8ab3a6081f7 missing interface error
8aa2d11a24cd94587767c2e6c29105fdcd3df350 struct constr as selector
f915997807749a4d8d8b4aa40a29418b48923d7f fix ac bug found with...
343c5e57f404a3a7e5b2e7f299fb0abbf0d10d87 ... known constant lengths
5e37cbe072ec7cec31722d2d3061bc5cbfb214be catch proc ptr interface error
96f566b6fab70c6ea0e09221b1ed0f0bddbf7331 accept BOZ in ac's w/o explicit types
2ed4ccb42c71fc8544863137fed440bd8cdd4572 fix folding of CMPLX
a052097df4ca6122fe96db2fd6a668d06b78ed81 fix crash from failed source->scope mapping
3d2d194554afa39afae0f9836d81639afb6d4fe2 fix regression with...
e67552e09a03907e35e21dbd22253886a3b2618f Fix 2 symbol table bugs with ENTRY
27c3db32c033663dbdfa8b92ed962a990b99f21e patch...
854367240d62802a547d25fb6027b2c3956e8cbf patch...
e00a170246564f420eb1aca7b2d45f1ed0a0de79 more transformationals
6b3fe6acf28b5960d8802e705e03d1aea604f197 fix OPEN(ACCESS='APPEND') error checking
78d4745d6b4f8cb04bdecafe21d7fe95c8beda06 MATMUL
31c465911d5fe0f0e3bcdc03a3861fc6b63118c3 add tool for Val
50f56d5369ee08d3537b7af5b0353fd4aff8e06f DOT_PRODUCT
adcb4594db216de6d811d0ef1e0245447d8ddaf9 OPEN(ACCESS='APPEND')
5dea53b9ec794b7c279608706ebc15d928f0426d NORM2
c6d9577771112cdf4de526f0afe1de4669938a24 NAMELIST runtime
75580af3f8a2fbdcb44391e903e3ae64df4ed358 defer formatted/unformmated connection to first I/O
9ef59fc62a0fbc01356119d86aadfdfd6ec73b28 Val adds accessor
527eafc8ed596c9e73a20e5a56809e6ebbaa4552 fix race condition on units 5 & 6
6fe81d7fb2a54eba6a2b75069d29c2de339aa452 fix crash on -DEMPTY=
8e1d6f42044cbb424fecbdc4962e98b84b3f9f51 break up flang/runtime/reduction.cpp
dfb286ddcdef664dec75e459496a999eb5e01b17 add FortranFeatureHistory.md
48acc1f1a33f71d52436fd985d0dc288f74e8854 Fix up bogus errors from table construction
ba39bbb5e542a59aecd4de1e067eb9f46a49332d IPARITY, PARITY, & FINDLOC
f645145798850d8b39d1ab96850d88cf6b674d0e Define some missing IEEE_ARITHMETIC symbols
854002f3c6ce6b7d79cf9dafc19bc854138d7bcc Fix BIND(C,NAME='') interpretation
afba451319ccf0d900ce3818df071503ee1c5055 Fix END= handling on input
11d0a4ea4f6ffd2fa112802dad4a776e855f4d22 Fix Boolean flags in I/O runtime arguments
de960200ecf9e7eae354428786b041309b1af5ab ieee_selected_real_kind
0f6b56d5ba2b0763978aa6335a2263cc0ad8d9da check for BIND(C) name conflict
a85735fca8304cb89d56d3c9780cc6ebb5fadd05 PDT instantiation limit
ba937ee4fff77b86d2086312c6e9a6f646cb4d7d random_number
d0b4148075ab3f607dc6d59ec4b42d619274461e TRANSFER
df485848e8d67c45960111f0b2160ba5aae9cd6e numeric intrinsics
f78a2a711fd964299e887f3745ceba3023c4e82a reduction intrinsics
6f3f8cfd78fe49673e1d1fd09486c5cee6f0e5d0 refine pointer initialization targets
9b81ec0332f933633635e89ccd5a4d6ae90e1d0e Refine symbol sorting
1a4f05f181e84b01575efed2167a53bb688198b1 two fixes merged with ...
9f37b0ed950ad6591304d7b1ed5d43231fcefab3 ... provenance-based symbol ordering
d0a0f2f309bd0e125f3063f38d41d0ad9edba1ac gtestified unit tests for INDEX
6f9e15415375cd7ad4b074a610f9a62345f4497d + INDEX
f59ae6e3bc772f802eee4b71f38f1deafe97153e ptr-valued func calls as variables
2a6b5e282ec1a6a76079c7db8cf77ab0b54bd8bc Val: (de)allocate API const args
b25eba6e565c6a7a177c10d62c21f0354917ad6f SCAN and VERIFY
f60dc3884542b5138118d5ca5459781a052e0f86 Extension: forward refs to dummy args IMPLICIT NONE
8a272fedcf6d50eead562542ddd198b54ac7ae0c Warn about explicit typing of generic intrinsics
f1ba830b9389565f457a3995c2f5bbe38f525f31 Ensure intrinsics PURE &/or ELEMENTAL
57399aa56412701d2732b06ff952920f5e484182 Improve module file error message
58bc31e82d3237010c18460eb831d07c58c3f548 Don't predefine macros for "no pp" source files
2b3096ac32f7b1b66ee46c6789d484372aa28dd4 Specific procedures with same names as generics
cebfc1c07cbff365a1d37959bc1362c806fe43fe Manage specification part state better
789d396fcee2e20a53aa08fe8d65c8b542dc685d TypeAndShape::MeasureElementSizeInBytes
38ab67d3353ca803735e302634a4a71fffc8ca20 Error on UBOUND(assumed-size array)
2274d6e7bcd216adaf46d418eb1a1924eef455c2 IEEE_SUPPORT_...
04163734d1a57bce24fff0da783f5a89c965a584 WRITE(I+J) parsing
bc2527d3e5387bca1a1537e0112768c22cf5d28c shape & length characterization
46dadb65bc28e8706d4bb8664cc49ac52dc32e65 alternative PARAMETER statement
35f2e72ada580f34667c50d7a25494423d0ad57f REAL128
fc4204b83318f700568926da4fca66ac0106c4f5 search paths
cb2e47fa0b624d1a638106afa4c854d75a7c87af fix bogus errors with bindings (Whizard)
bb4e4d27841e3386ce4b89b8f41f0e0ec1e438c2 NULL() actual for dummy pointer (Whizard)
a7f6cceb8b0cf5eff2d57aa6823ef2597d24dab2 name resolution fixes (Whizard)
67a6995597bb56665e2964e623424a2b80fe2e67 folding improvements (Whizard)
7ffe862ffacc0a52896a935055dad2a1bc18bb10 intrinsics work (Whizard)
42ebd88fbd511a211771a910d04ff28a5f015e6c Better C_LOC and C_ASSOCIATED (Whizard)
4872d822686138ba295c087b149064e16b7832f6 tweaks to utilities for Whizard
6c11b0d6cca58c1b268b97738607cbaddf5011c3 Val: ASSOCIATE
35ecf8fc4839926d5b6fed75ec73362c8ccbbe91 WhyNotModifiable updates (Whizard)
31f9a918c4f2f257d72e9de7661dcaccfa83e4e5 access specific procedures via aliases (Whizard)
7882a0071c6e4fe9e0bfac26edc611ae98bce844 whizard module file issues
bd84c126df9467c8e37d41dd6088f13ab563be02 don't create HostAssocDetails symbols in derived type scopes
6485856881624f179e956e2373d7caa212178cbd classification of shape inquiries
1d622fe4d30847bfb78270ae00155410758b2f69 fix crash in folding (bug#48437)
dec36fefb3bec8f72a2087196ab8ad64cde2960f STORAGE_SIZE() & al.
4c2ca630fd1d6b8ae3d6f806bd95084bddf6cede fix bogus error for "p=>f()" array conformance
75046911802cd9e26f9d6629c93e2adba11d4985 clean up TODOs
7ec16c973cb9e36a6c38a73769fa598c10a776a6 fix list-directed REAL output
252fccb64d27ada4365e684342967695a9047095 + clang patches for...
145f0bbe938fa477218266723a9f3ce1d1f95a54 ... runtime tables
b8ae4c56e5a2570b4751c3b7cac89eb3b3a64133 improve initializer semantics
d7caeab6b416248f06cf44c4c686a5e6304943bd fix NULL pointer initializers
2cb85cef1097baac219c22da442656588f458c68 Unsplit COMPLEX
0e755edbc0eb29d98c6d2a069beb309921c79bfd DO CONCURRENT document
bc44d4826fa3fb9407af497c16f86d720b205f91 Val D.: fix missing provenance
bc50a56fa74b05a78d12c81531edd1ebd00ef13e END FILE
3ce5f957165d01b5123dfc62429f5ed1d1b6103d panicky patch for failed aarch64 build of f/r/allocatable.cpp
13a9b60141e2f01d8533cb3a97d0fd19a34b82a3 + patch for shared libs for ...
d93418558f68954e0dbfe3d310af6010aa387f2a ... fix CheckSpec.Expr w/ associations
a49a36416647c25dcb831ab364cc96bf47506f17 [msvc] replace some forward_list<>
8b24f3f99eeab2b85e64406c8df8c30405efb037 basic ALLOCATE/DEALLOCATE runtime
df91cd575ca60b863cebc229604cebe8d1989600 Val D.: labels on ENDs
0211380d6827a9b0b3bf802b986600675c0d844a IMPLICIT from scope of reference
11a700af38b87b29c71ced1a56927ea56d6f623c isnan
e16c0d6dc843fb75a1d74f0ba8686421bba9819b fix error recovery crash
43977591f07a213fc9d45e5123c60f1b876c2f45 FINAL pitfall warning
384462091bcc850c611d255bdbf16761df00e32b fix bad error message
ee73f451716c5a0cf30dd5204c7a062502841aae fix intrinsics actual arg char lengths
a81e73590c0a0e7154c63cbe58cf07f69072245b design doc for runtime table req'ts
41f150eff92462c6707abdb6826f82b4ee960fa9 ac implied DO indices are const exprs
e16c0d6dc843fb75a1d74f0ba8686421bba9819b plug error recovery hole
384462091bcc850c611d255bdbf16761df00e32b fix false error in...
0c4288b4b58fcc8d31b4b0500384f5de04ad0ea9 ... better errors for bad fwd refs
43977591f07a213fc9d45e5123c60f1b876c2f45 warn about FINAL pitfall
643c51aa7a84afe7a13b95ab79b3003fa549a50f rewrite ambiguous READ(CVAR)
86d91c271f790cca252cbd473993e261681752c0 allow "name:value" in !DIR$
930bd6cc9002221b71e6a1a84beb8534025ce85e whole assumed-size array usage
d2d626b2ab38d74f6751fc74ea2e6f1085ce987d TypeAndShape CHAR len tracking
e220d05f3f6bebc75ee266422065199022e2a133 correct kP scaling on F output edit
7b4222f5ef07ed6207e450211d8ca2030cd517ee correct binary->decimal buffer sizes
f231f308327698042a6ba2daf0d1e66297489f44 PAUSE with stop-code
554e34506694ae9babe84fe64242b45fc338d143 pad unformatted fixed-sized output
d479c9a99eaefac16bf54bf4fe47d1e66280a255 fix read->write transition in buffer
ae69ace3c66a6b71fbabc37717423cb50ebe5dd3 fix Kruse MSVC clang build breakage
75cf994910e378a7d0b860c9d20b7b246215d5e0 remove custom unsigned int const div
d235cfa38f1ee3e949c96f428603d00d6f44ebc7 fix WRITE after BACKSPACE
a8abdb0226b775f148ec7fc89e49b268d623053a fix INQUIRE access/formatting options
0f0820df3fe804d9bad958023e0ba2a7761e139e add checks (formatted in unf. I/O)
bc0d6562d878756beb1c4fb9f895743d4b5d55e4 fix Gw.d output edit cases
5bf42531cc9c84449d292e041b34281d007d4e1f fix / in external sequential READ
60535ce5082b559c8c2f87d630b2772c6d3daca9 FINAL semantics
f9c7d504bfb6f1640626e025737846642f8a8ae6 fix list-directed CHAR & LOGICAL array
4bfddefbb43c875dc7dec81fdb74af4f09cc0f34 + ...
a498ba8858f00ee962460637601d6342d22ebcd7 + pp fixes
a3e9d0ae1d5fac9ccc456b6ad21dc18882e45989 BZ mode in exponents
ef30acce6226d0ea82a9b2ae0289ae03ccc9ace2 #include "" ! comment
6ec065e18d9721c4016b1a903aea373c0e0f4e28 more CookedSource clean-up
9104b220740a822b0c3e0c24bfbb42f5a55a8a9d Val CARRIAGECONTROL
f4bc1435a6994bfaf65add1ed5ec597b81283446 multiple CookedSource instances
94398b3136e66fc534b6b682954b36b8a9bc1e17 deterministic dump output
0249414ff3cd1cc56d02614905698a3c6f9eaf60 better CASE integer typing
9418aedb1060010f0fad700a25dc20dcfacd1752 operand shape conformance checking
c81775fb03549c3c41feecbba12296f151ffeb93 shape conformance on initializers
9c8a452a959ac8e192f8830e2424b6a6aefcb769 make TypeParamInquiry monomorphic
92e34ce6fbd27e6ec6fc8c6b8b14e0f31dc10683 Val: label fix
2a0a8546ab20ae10aaa93d22064a7902fb3176fc Val: I/O vars must be definable
9a0729bef334363f4a3c8656e2c2322a7a3464ad better errors for bad chars
b96885a61ac50f28e8d226b68d5d2f72b763402c parse global compiler directives
bf0c51cda762f9230ae25b9560b09b79422839a8 don't left justify tokenization
a956f1d2e09dffc5468b7f68d5cf0898978008cc fix size in descriptor I/O
7ca7cb9cbbbfa38a2fd6c72b83f9f59bb02a044a shape(TRANSFER)
db41a84e6b0ddef75e823013174b1ea2be8f4612 fix mixed complex expressions
6d9cedd7031eddb0f1b04822953a52d5b54fd307 fix predefined macros
811fcb8af2dc46ca1861edc3f63d8a24c2cff677 PAD='YES' default
659ff2a3aac95903b83041f5738d8b902f2de88f Hollerith edge case
f769a9cd30a14f26e7cd830b3a4ccb018d88c321 Tim: fix warning in...
2a8050742abcbd4b849ce02c1b509b40d1dfbb07 DATA init with EQUIVALENCE
0a56419a5297ee1535fc776fe6fb2e31dbc10596 DATA init with Hollerith
80799e0ac6186955ab39ac98cd672c5990acea5c descriptor-based I/O
37414493d4e2fe6d191f9e02ab3628e30ca741e1 reformatting with latest clang-format
ad833c592eb0fb0b62556b3f046775226a086906 INQUIRE runtime
8b94d9abdfe47f39747e3c9dd965c35101775c9e defer "next input record" stuff
a1471e6303d8ef22afe4e81730e03c0e274dc453 file accessibility, size, positions
cf4f53ebf57e7f8085667f22720862fe1e7b0682 spaces in REAL input
da12a506b0c50d917cfa0ae75ba34825a3a1c602 remove RoundDefault enumerator
6cb7031500436edcf71db47499f41306994922ac pp tests (+ next)
1fd5e3377b1cfee4251d6321e50f9aec4a02cabd ... misplaced label check
64c63fc3bf2b22ea39731844990d342e0aabfe4f Allow no-comma FORMAT(1PE5.2)
a27b0abbeef9c2a4774a0050b6561be4a3624566 Add {Out,In}putComplex{32,64}
47215cfb52b6e09049029b9d8b5f41b565ae94c6 FORMAT reversion (2) +
226a109d9635290434e919a21bbe6d436bad480c FORMAT reversion (1)
fde8f0ea8a030fb509e627df9f97c3620931bb2a source continuation in macro calls
25d2c39f20e2f43ad156f9e8edcd84b9070a1979 byte-swapped unformatted I/O
68d420483aded068f6d96c6684aeb82240fd7d54 fix REAL formatted input case
1fd5e3377b1cfee4251d6321e50f9aec4a02cabd complain about misplaced labels
476ed2470cd9abd90972a7a7d1099a26ae8c6744 clean up STOP output
2fdc74ec2fef96dee8fdb3451b6e748da077147c fix Lw formatting
72461072df569694a33b3f1b41f9724fa16e457c fix bogus runtime error message
8a6a875d375d332843de6a083ebce423166e94c7 treat \t as ' ' in runtime input
c03be4e7414fff50d7c6cb7bac432f180f8a40b2 !DIR$ name=value
8548a3b66207186576883ad405b6cc0b804f92b4 allow comments on pp directives
63a783e08f79d606aebe510c60f4bab62438f763 rework r/w permissions on OPEN
16f03d4a4b778d13ebb28ddfb53045269c53a4a3 entries for scalar internal list IO
ce4dcd4ceb2ad77dc0bca991ad65c3f36231eadf fix fm923.f
499fdc0bfcd6d429ced29d629b09b9d08ea1f783 Anonymous external I/O units (fm401)
0917928b904cd7e63fc862901860dc3ce2d6971a Fix CR handling (fix) +
e25472e0d6bbe641a562927f53ef29c73c9d3673 ... fix CR handling (orig)
eb74a903396ff81dc23dcbd9c5dbc06dca528e86 Speed up real binary->dec
a52fdfdd9aebbefc61d3e664565ecc77322a47ac fix shared lib build
d95b91d77e1f40edfe7bf89eaea58fbe0744a39f fix unit number hash
60c58f58ba6048d0c1c5b1324d4b5bedc6dc9f73 Fix lowering bug #230
446c41b0c944fd9dff1d872c5c4459e8e9cbe53d Clean up runtime binary deps
9b8b332822221a409cc2e81b6fc3bd51a91cdb03 EQUIVALENCE fixes
acba890a16e6d2b26db1aefb5c17c9822f7ba26a Defer stmt func body analysis
dab72aa39d4c403adf4da5c819b32e4e9860c687 shape analysis of MATMUL
9ed81c9450a108357e21a0e82adca7070d6ddad1 fix F5.3 formatting of 0.025
831c6f18c405147ef36115e4239ce928ca78a165 DATA: processing & conversion to inits
008bd342b28bd46960b2214b58977f1bd4b473a0 DATA: remaining prep work
de3188d0c93ccf6850c0c9c0f7d21284ab30baeb DATA: initial images
7d8047a25f8bb2a07ba639d4d90caa11bb64bf42 DATA: designator folding
082c73c3467d7c02471fca9ec93167345c1856f0 roll-up small runtime fixes
21ea58e02d5aea966f5d393025d44d9ff56b0a95 fix osx build problems
049e7e5b79b357f3a4a24fbfdf2ce5d263f74ef2 + more CHARACTER runtime
cd2ce94f9c59d887ce84092d1eb970ade5fc32c4 Fix to IsDescriptor()
266e4b21f17b91d1a844ffa734af478df96d9038 Equivalence & common offsets
f5989ad96f2290e4d276a12c75591bb53be55b6c Add equivalence & common accessors
91585b69a235cc9cfe6bd7820544d2ea0b9b93a7 Fix x87 binary->decimal
baeff4139d3b6468790fb5ba999d74469d12f63d DATA statement rework
ed6d92af6bc65d917cd1243b314989a0017363d4 CHARACTER runtime

Not forwarded to LLVM:
6aa92cdec11af2369928e2bffda9401d5a1d8775 work around broken oot build
3216cf630345f4378783115b86cf89f68989091d Typed blobs
ab2dac0035620cf281871116cb5adeda49a26b52 fix build breakage
